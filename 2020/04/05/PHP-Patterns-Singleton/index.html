<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="note,PHP," />










<meta name="description" content="Talk is cheap, show me the code.">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP Patterns: Singleton">
<meta property="og:url" content="http://yoursite.com/2020/04/05/PHP-Patterns-Singleton/index.html">
<meta property="og:site_name" content="Fanfan&#39;s Blog">
<meta property="og:description" content="Talk is cheap, show me the code.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.stack.imgur.com/Dzdio.png">
<meta property="article:published_time" content="2020-04-05T11:37:59.000Z">
<meta property="article:modified_time" content="2020-04-05T12:08:07.723Z">
<meta property="article:author" content="Shan Mi">
<meta property="article:tag" content="note">
<meta property="article:tag" content="PHP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.stack.imgur.com/Dzdio.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/04/05/PHP-Patterns-Singleton/"/>





  <title>PHP Patterns: Singleton | Fanfan's Blog</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fanfan's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Better than ever</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/05/PHP-Patterns-Singleton/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shan Mi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fanfan's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PHP Patterns: Singleton</h1>
        

        <div class="post-meta">
          

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-05T13:37:59+02:00">
                2020-04-05
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-04-05T14:08:07+02:00">
                2020-04-05
              </time>
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/04/05/PHP-Patterns-Singleton/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/04/05/PHP-Patterns-Singleton/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>Talk is cheap, show me the code.</strong></p>
<a id="more"></a>
<h3 id="单例在-PHP-中的实现"><a href="#单例在-PHP-中的实现" class="headerlink" title="单例在 PHP 中的实现"></a>单例在 PHP 中的实现</h3><p><a href="https://refactoringguru.cn/design-patterns/singleton/php/example" target="_blank" rel="noopener">Original</a><br>单例是一种创建型设计模式，让你能够保证一个类只有一个实例，并提供一个访问该实例的全局节点。</p>
<p>单例拥有与全局变量相同的优缺点。尽管它们非常有用，但却会破坏代码的模块化特性。</p>
<p>你可能会在一些其他情况下使用依赖于单例的类。你也将必须使用单例类。绝大多数情况下，该限制会在创建单元测试时出现。</p>
<h4 id="在-PHP-中使用模式"><a href="#在-PHP-中使用模式" class="headerlink" title="在 PHP 中使用模式"></a>在 PHP 中使用模式</h4><p>复杂度： <i class="fa fa-fw fa-star" aria-hidden="true"></i><i class="fa fa-fw fa-star-o" aria-hidden="true"></i><i class="fa fa-fw fa-star-o" aria-hidden="true"></i><br>流行度： <i class="fa fa-fw fa-star" aria-hidden="true"></i><i class="fa fa-fw fa-star" aria-hidden="true"></i><i class="fa fa-fw fa-star-o" aria-hidden="true"></i></p>
<p>使用示例：<br>许多开发者将单例模式视为一种<strong>反模式</strong>。因此它在 PHP 代码中的使用频率正在<strong>逐步减少</strong>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Singleton</span>\<span class="title">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Singleton class defines the `GetInstance` method that serves as an</span></span><br><span class="line"><span class="comment"> * alternative to constructor and lets clients access the same instance of this</span></span><br><span class="line"><span class="comment"> * class over and over.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Singleton's instance is stored in a static field. This field is an</span></span><br><span class="line"><span class="comment">     * array, because we'll allow our Singleton to have subclasses. Each item in</span></span><br><span class="line"><span class="comment">     * this array will be an instance of a specific Singleton's subclass. You'll</span></span><br><span class="line"><span class="comment">     * see how this works in a moment.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $instances = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Singleton's constructor should always be private to prevent direct</span></span><br><span class="line"><span class="comment">     * construction calls with the `new` operator.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Singletons should not be cloneable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Singletons should not be restorable from strings.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">"Cannot unserialize a singleton."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This is the static method that controls the access to the singleton</span></span><br><span class="line"><span class="comment">     * instance. On the first run, it creates a singleton object and places it</span></span><br><span class="line"><span class="comment">     * into the static field. On subsequent runs, it returns the client existing</span></span><br><span class="line"><span class="comment">     * object stored in the static field.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This implementation lets you subclass the Singleton class while keeping</span></span><br><span class="line"><span class="comment">     * just one instance of each subclass around.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span>: <span class="title">Singleton</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $cls = <span class="keyword">static</span>::class;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">self</span>::$instances[$cls])) &#123;</span><br><span class="line">            <span class="keyword">self</span>::$instances[$cls] = <span class="keyword">new</span> <span class="keyword">static</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$instances[$cls];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Finally, any singleton should define some business logic, which can be</span></span><br><span class="line"><span class="comment">     * executed on its instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">someBusinessLogic</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $s1 = Singleton::getInstance();</span><br><span class="line">    $s2 = Singleton::getInstance();</span><br><span class="line">    <span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Singleton works, both variables contain the same instance."</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Singleton failed, variables contain different instances."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clientCode();</span><br></pre></td></tr></table></figure>
<p>Output.txt:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Singleton works, both variables contain the same instance.</span><br></pre></td></tr></table></figure>

<h4 id="真实世界示例"><a href="#真实世界示例" class="headerlink" title="真实世界示例"></a>真实世界示例</h4><p>单例模式由于限制了代码复用，且让单元测试复杂化而名声不佳。但它在有些情况下仍然非常实用，特别是在需要<strong>控制一些共享资源</strong>时十分方便。例如，全局日志对象必须对日志文件的访问权限进行控制。另一个例子：<strong>共享的运行时配置存储</strong>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Singleton</span>\<span class="title">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If you need to support several types of Singletons in your app, you can</span></span><br><span class="line"><span class="comment"> * define the basic features of the Singleton in a base class, while moving the</span></span><br><span class="line"><span class="comment"> * actual business logic (like logging) to subclasses.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The actual singleton's instance almost always resides inside a static</span></span><br><span class="line"><span class="comment">     * field. In this case, the static field is an array, where each subclass of</span></span><br><span class="line"><span class="comment">     * the Singleton stores its own instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $instances = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Singleton's constructor should not be public. However, it can't be</span></span><br><span class="line"><span class="comment">     * private either if we want to allow subclassing.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Cloning and unserialization are not permitted for singletons.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">"Cannot unserialize singleton"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The method you use to get the Singleton's instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $subclass = <span class="keyword">static</span>::class;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">self</span>::$instances[$subclass])) &#123;</span><br><span class="line">            <span class="comment">// Note that here we use the "static" keyword instead of the actual</span></span><br><span class="line">            <span class="comment">// class name. In this context, the "static" keyword means "the name</span></span><br><span class="line">            <span class="comment">// of the current class". That detail is important because when the</span></span><br><span class="line">            <span class="comment">// method is called on the subclass, we want an instance of that</span></span><br><span class="line">            <span class="comment">// subclass to be created here.</span></span><br><span class="line">           </span><br><span class="line">            <span class="keyword">self</span>::$instances[$subclass] = <span class="keyword">new</span> <span class="keyword">static</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$instances[$subclass];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The logging class is the most known and praised use of the Singleton pattern.</span></span><br><span class="line"><span class="comment"> * In most cases, you need a single logging object that writes to a single log</span></span><br><span class="line"><span class="comment"> * file (control over shared resource). You also need a convenient way to access</span></span><br><span class="line"><span class="comment"> * that instance from any context of your app (global access point).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> <span class="keyword">extends</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A file pointer resource of the log file.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $fileHandle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Since the Singleton's constructor is called only once, just a single file</span></span><br><span class="line"><span class="comment">     * resource is opened at all times.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Note, for the sake of simplicity, we open the console stream instead of</span></span><br><span class="line"><span class="comment">     * the actual file here.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;fileHandle = fopen(<span class="string">'php://stdout'</span>, <span class="string">'w'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Write a log entry to the opened file resource.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeLog</span><span class="params">(string $message)</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $date = date(<span class="string">'Y-m-d'</span>);</span><br><span class="line">        fwrite(<span class="keyword">$this</span>-&gt;fileHandle, <span class="string">"$date: $message\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Just a handy shortcut to reduce the amount of code needed to log messages</span></span><br><span class="line"><span class="comment">     * from the client code.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span><span class="params">(string $message)</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $logger = <span class="keyword">static</span>::getInstance();</span><br><span class="line">        $logger-&gt;writeLog($message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Applying the Singleton pattern to the configuration storage is also a common</span></span><br><span class="line"><span class="comment"> * practice. Often you need to access application configurations from a lot of</span></span><br><span class="line"><span class="comment"> * different places of the program. Singleton gives you that comfort.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span> <span class="keyword">extends</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $hashmap = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span><span class="params">(string $key)</span>: <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hashmap[$key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setValue</span><span class="params">(string $key, string $value)</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hashmap[$key] = $value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Logger::log(<span class="string">"Started!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compare values of Logger singleton.</span></span><br><span class="line">$l1 = Logger::getInstance();</span><br><span class="line">$l2 = Logger::getInstance();</span><br><span class="line"><span class="keyword">if</span> ($l1 === $l2) &#123;</span><br><span class="line">    Logger::log(<span class="string">"Logger has a single instance."</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Logger::log(<span class="string">"Loggers are different."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check how Config singleton saves data...</span></span><br><span class="line">$config1 = Config::getInstance();</span><br><span class="line">$login = <span class="string">"test_login"</span>;</span><br><span class="line">$password = <span class="string">"test_password"</span>;</span><br><span class="line">$config1-&gt;setValue(<span class="string">"login"</span>, $login);</span><br><span class="line">$config1-&gt;setValue(<span class="string">"password"</span>, $password);</span><br><span class="line"><span class="comment">// ...and restores it.</span></span><br><span class="line">$config2 = Config::getInstance();</span><br><span class="line"><span class="keyword">if</span> ($login == $config2-&gt;getValue(<span class="string">"login"</span>) &amp;&amp;</span><br><span class="line">    $password == $config2-&gt;getValue(<span class="string">"password"</span>)</span><br><span class="line">) &#123;</span><br><span class="line">    Logger::log(<span class="string">"Config singleton also works fine."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Logger::log(<span class="string">"Finished!"</span>);</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-06-04: Started!</span><br><span class="line">2018-06-04: Logger has a single instance.</span><br><span class="line">2018-06-04: Config singleton also works fine.</span><br><span class="line">2018-06-04: Finished!</span><br></pre></td></tr></table></figure>

<h4 id="More-Examples"><a href="#More-Examples" class="headerlink" title="More Examples"></a>More Examples</h4><hr>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 单列模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.普通类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s1 = <span class="keyword">new</span> singleton();</span><br><span class="line">$s2 = <span class="keyword">new</span> singleton();</span><br><span class="line"><span class="comment">//注意，2个变量是同1个对象的时候才全等</span></span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是一个对象'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.封锁new操作</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">$s1 = <span class="keyword">new</span> singleton(); <span class="comment">//PHP Fatal error:  Call to protected singleton::__construct()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.留个接口来new对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getIns</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s1 =  singleton::getIns();</span><br><span class="line">$s2 =  singleton::getIns();</span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是一个对象'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.getIns先判断实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">static</span> $ins = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getIns</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>::$ins === <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>::$ins = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>::$ins;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s1 =  singleton::getIns();</span><br><span class="line">$s2 =  singleton::getIns();</span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是一个对象'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">$s1 =  <span class="keyword">new</span> A();</span><br><span class="line">$s2 =  <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是同一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是同一个对象'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//5.防止继承时被修改了权限</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">static</span> $ins = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//方法加final则方法不能被覆盖，类加final则类不能被继承</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getIns</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>::$ins === <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>::$ins = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>::$ins;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s1 =  singleton::getIns();</span><br><span class="line">$s2 =  singleton::getIns();</span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是同一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是同一个对象'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Cannot override final method singleton::__construct()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">$s1 =  singleton::getIns();</span><br><span class="line">$s2 =  <span class="keyword">clone</span> $s1;</span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是同一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是同一个对象'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//6.防止被clone</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">static</span> $ins = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//方法加final则方法不能被覆盖，类加final则类不能被继承</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getIns</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>::$ins === <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>::$ins = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>::$ins;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 封锁clone</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s1 = singleton::getIns();</span><br><span class="line">$s2 = <span class="keyword">clone</span> $s1; <span class="comment">//Call to private singleton::__clone() from context</span></span><br><span class="line"><span class="keyword">if</span> ($s1 === $s2) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'是同一个对象'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'不是同一个对象'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="More-quotations"><a href="#More-quotations" class="headerlink" title="More quotations:"></a>More quotations:</h3><p><a href="https://stackoverflow.com/questions/4595964/is-there-a-use-case-for-singletons-with-database-access-in-php/4596323#4596323" target="_blank" rel="noopener">stackoverflow</a></p>
<h4 id="Singletons-have-very-little-if-not-to-say-no-use-in-PHP"><a href="#Singletons-have-very-little-if-not-to-say-no-use-in-PHP" class="headerlink" title="Singletons have very little - if not to say no - use in PHP."></a>Singletons have very little - if not to say no - use in PHP.</h4><p>In languages where objects live in shared memory, Singletons can be used to keep memory usage low. Instead of creating two objects, you reference an existing instance from the globally shared application memory. In PHP there is no such application memory. A Singleton created in one Request lives for exactly that request. A Singleton created in another Request done at the same time is still a completely different instance. Thus, one of the two main purposes of a Singleton is not applicable here.</p>
<p>In addition, many of the objects that can conceptually exist only once in your application do not necessarily require a language mechanism to enforce this. If you need only one instance, then <a href="http://butunclebob.com/ArticleS.UncleBob.SingletonVsJustCreateOne" target="_blank" rel="noopener">don&#39;t instantiate another</a>. It&#39;s only when you may have no other instance, e.g. when kittens die when you create a second instance, that you might have a valid Use Case for a Singleton.</p>
<p>The other purpose would be to have a global access point to an instance within the same Request. While this might sound desirable, it really isnt, because it creates coupling to the global scope (like any globals and statics). <a href="http://sebastian-bergmann.de/archives/882-Testing-Code-That-Uses-Singletons.html" target="_blank" rel="noopener">This makes Unit-Testing harder</a> and your application in general less maintainable. There is ways to mitigate this, but in general, if you need to have the same instance in many classes, use <a href="http://fabien.potencier.org/article/11/what-is-dependency-injection" target="_blank" rel="noopener">Dependency Injection</a>.</p>
<p>See my slides for <a href="http://www.slideshare.net/go_oh/singletons-in-php-why-they-are-bad-and-how-you-can-eliminate-them-from-your-applications" target="_blank" rel="noopener">Singletons in PHP - Why they are bad and how you can eliminate them from your applications</a> for additional information.</p>
<p>Even <a href="http://en.wikipedia.org/wiki/Erich_Gamma" target="_blank" rel="noopener">Erich Gamma</a>, one of the Singleton pattern&#39;s inventors, doubts this pattern nowadays:</p>
<p>“<a href="http://www.informit.com/articles/printerfriendly.aspx?p=1404056" target="_blank" rel="noopener">I&#39;m in favor of dropping Singleton. Its use is almost always a design smell</a>“</p>
<h4 id="Further-reading"><a href="#Further-reading" class="headerlink" title="Further reading"></a>Further reading</h4><p><a href="https://stackoverflow.com/questions/5283102/how-is-testing-registry-pattern-or-singleton-hard-in-php/5283151#5283151" target="_blank" rel="noopener">How is testing the registry pattern or singleton hard in PHP?</a><br><a href="https://stackoverflow.com/questions/3124412/what-are-the-disadvantages-of-using-a-php-database-class-as-singleton/3124428#3124428" target="_blank" rel="noopener">What are the disadvantages of using a PHP database class as a singleton?</a><br><a href="https://stackoverflow.com/questions/3272090/php-pdo-database-abstraction-class-design-question/3274863#3274863" target="_blank" rel="noopener">Database abstraction class design using PHP PDO</a><br><a href="https://stackoverflow.com/questions/3870635/would-singleton-be-a-good-design-pattern-for-a-microblogging-site/3870710#3870710" target="_blank" rel="noopener">Would singleton be a good design pattern for a microblogging site?</a><br><a href="https://stackoverflow.com/questions/4244437/modifying-a-class-to-encapsulate-instead-of-inherit/4244824#4244824" target="_blank" rel="noopener">Modifying a class to encapsulate instead of inherit</a><br><a href="https://stackoverflow.com/questions/3820103/how-to-access-an-object-from-another-class/3820286#3820286" target="_blank" rel="noopener">How to access an object from another class?</a><br><a href="http://blog.gordon-oheim.biz/2011-01-17-Why-Singletons-have-no-use-in-PHP/" target="_blank" rel="noopener">Why Singletons have no use in PHP</a><br><a href="http://www.youtube.com/watch?v=-FRm3VPhseI" target="_blank" rel="noopener">The Clean Code Talks - Singletons and Global State</a><br>If, after the above, you still need help deciding: Singleton Decision Diagram</p>
<img style="background: white;" src="https://i.stack.imgur.com/Dzdio.png">
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/note/" rel="tag"># note</a>
          
            <a href="/tags/PHP/" rel="tag"># PHP</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/31/postBirthday-again/" rel="next" title="Birthday again & notes about axios">
                <i class="fa fa-chevron-left"></i> Birthday again & notes about axios
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/22/Something-about-setting-responsive-layout-on-IE/" rel="prev" title="Something about setting responsive layout on IE">
                Something about setting responsive layout on IE <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Shan Mi" />
            
              <p class="site-author-name" itemprop="name">Shan Mi</p>
              <p class="site-description motion-element" itemprop="description">You will never know</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Shan-Mi" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:shan.mi.fanfan@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#单例在-PHP-中的实现"><span class="nav-number">1.</span> <span class="nav-text">单例在 PHP 中的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在-PHP-中使用模式"><span class="nav-number">1.1.</span> <span class="nav-text">在 PHP 中使用模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#真实世界示例"><span class="nav-number">1.2.</span> <span class="nav-text">真实世界示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#More-Examples"><span class="nav-number">1.3.</span> <span class="nav-text">More Examples</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#More-quotations"><span class="nav-number">2.</span> <span class="nav-text">More quotations:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Singletons-have-very-little-if-not-to-say-no-use-in-PHP"><span class="nav-number">2.1.</span> <span class="nav-text">Singletons have very little - if not to say no - use in PHP.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Further-reading"><span class="nav-number">2.2.</span> <span class="nav-text">Further reading</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shan Mi</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  View:<span id="busuanzi_value_site_uv"></span> times
</span>
</div>

  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      visits
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      visits
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://shanmi.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2020/04/05/PHP-Patterns-Singleton/';
          this.page.identifier = '2020/04/05/PHP-Patterns-Singleton/';
          this.page.title = 'PHP Patterns: Singleton';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://shanmi.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  





  

  

  

  
  

  

  

  


</body>
</html>

